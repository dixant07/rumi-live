!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.RumiBot=e():t.RumiBot=e()}(this,()=>(()=>{"use strict";var t={164(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.NetworkProtocol=e.MSG_TYPE=void 0,e.MSG_TYPE={BAT_UPDATE:1,HIT_EVENT:2,SCORE_UPDATE:3,PING:4},e.NetworkProtocol=class{static encode(t){switch(t.type){case"bat":return this.encodeBatUpdate(t);case"hit":return this.encodeHitEvent(t);case"score":return this.encodeScoreUpdate(t);case"ping":return this.encodePing(t);default:return console.error("Unknown message type for encoding:",t.type),null}}static decode(t){const i=new DataView(t),s=i.getUint8(0);switch(s){case e.MSG_TYPE.BAT_UPDATE:return this.decodeBatUpdate(i);case e.MSG_TYPE.HIT_EVENT:return this.decodeHitEvent(i);case e.MSG_TYPE.SCORE_UPDATE:return this.decodeScoreUpdate(i);case e.MSG_TYPE.PING:return{type:"ping"};default:return console.error("Unknown message type for decoding:",s),null}}static encodeBatUpdate(t){const i=new ArrayBuffer(18),s=new DataView(i);return s.setUint8(0,e.MSG_TYPE.BAT_UPDATE),s.setUint8(1,"A"===t.role?1:2),s.setFloat32(2,t.x),s.setFloat32(6,t.y),s.setFloat32(10,t.vx||0),s.setFloat32(14,t.vy||0),i}static encodeHitEvent(t){const i=new ArrayBuffer(30),s=new DataView(i);s.setUint8(0,e.MSG_TYPE.HIT_EVENT);const n=t.state;return s.setFloat32(1,n.x),s.setFloat32(5,n.y),s.setFloat32(9,n.z),s.setFloat32(13,n.vx),s.setFloat32(17,n.vy),s.setFloat32(21,n.vz),s.setFloat32(25,n.spin||0),s.setUint8(29,t.isServing?1:0),i}static encodeScoreUpdate(t){const i=new ArrayBuffer(6),s=new DataView(i);return s.setUint8(0,e.MSG_TYPE.SCORE_UPDATE),s.setUint16(1,t.scoreA),s.setUint16(3,t.scoreB),s.setUint8(5,"A"===t.currentServer?1:2),i}static encodePing(t){const i=new ArrayBuffer(1);return new DataView(i).setUint8(0,e.MSG_TYPE.PING),i}static decodeBatUpdate(t){return{type:"bat",role:1===t.getUint8(1)?"A":"B",x:t.getFloat32(2),y:t.getFloat32(6),vx:t.getFloat32(10),vy:t.getFloat32(14)}}static decodeHitEvent(t){return{type:"hit",state:{x:t.getFloat32(1),y:t.getFloat32(5),z:t.getFloat32(9),vx:t.getFloat32(13),vy:t.getFloat32(17),vz:t.getFloat32(21),spin:t.getFloat32(25)},isServing:1===t.getUint8(29)}}static decodeScoreUpdate(t){return{type:"score",scoreA:t.getUint16(1),scoreB:t.getUint16(3),currentServer:1===t.getUint8(5)?"A":"B"}}}},202(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.KnifeThrowAI=void 0;const s=i(993);e.KnifeThrowAI=class{constructor(){this.knivesRemaining=6,this.opponentKnivesThrown=0,this.stuckAngles=[],this.discRotation=0,this.discSpeed=4,this.discDirection=1,this.lastThrowTime=0,this.nextThrowCooldown=600,this.roundStarted=!1,this.isWaitingForResult=!1,this.consecutiveThrows=0,this.waitStartTime=0,this.currentMomentum=0,this.excitementLevel=0,this.minAngleSeparation=12,this.COOLDOWN_MIN=300,this.COOLDOWN_MAX=900,this.BURST_COOLDOWN=200,this.INITIAL_DELAY_MIN=150,this.INITIAL_DELAY_MAX=400,this.MAX_WAIT_TIME=1500,this.KNIFE_FLIGHT_TIME=300,this.personality=this.pickRandomPersonality(),this.baseSkillLevel=this.calculateBaseSkill(),console.log(`[KnifeThrowAI] Initialized with personality: ${this.personality}, skill: ${this.baseSkillLevel.toFixed(2)}`)}pickRandomPersonality(){const t=Math.random();return t<.3?"aggressive":t<.55?"balanced":t<.8?"cautious":"chaotic"}calculateBaseSkill(){switch(this.personality){case"aggressive":return.55+.25*Math.random();case"cautious":return.65+.2*Math.random();case"balanced":return.6+.2*Math.random();case"chaotic":return.45+.35*Math.random()}}onMessage(t){const e=s.KnifeThrowNetworkProtocol.decode(t);if(e)switch(console.log("[KnifeThrowAI] Received message:",e.type),e.type){case"round_setup":this.handleRoundSetup(e.dummyKnives);break;case"rotation_update":this.discSpeed=e.speed,this.discDirection=e.direction,this.excitementLevel=Math.min(1,this.excitementLevel+.1),console.log("[KnifeThrowAI] Rotation update - speed:",this.discSpeed,"dir:",this.discDirection);break;case"throw_knife":e.success?(this.stuckAngles.push(e.angle),this.opponentKnivesThrown++,this.excitementLevel=Math.min(1,this.excitementLevel+.15),this.currentMomentum-=.1,console.log("[KnifeThrowAI] Opponent knife stuck at angle:",e.angle)):(this.currentMomentum+=.15,console.log("[KnifeThrowAI] Opponent missed!"));break;case"throw_start":this.excitementLevel=Math.min(1,this.excitementLevel+.05)}}handleRoundSetup(t){console.log("[KnifeThrowAI] Round setup with dummy knives:",t),this.stuckAngles=[...t],this.knivesRemaining=6,this.opponentKnivesThrown=0,this.roundStarted=!0,this.isWaitingForResult=!1,this.consecutiveThrows=0,this.excitementLevel=.2,this.currentMomentum=0;const e=this.getInitialDelay();this.lastThrowTime=Date.now()+e,this.calculateNextCooldown()}getInitialDelay(){switch(this.personality){case"aggressive":return this.INITIAL_DELAY_MIN+150*Math.random();case"cautious":return this.INITIAL_DELAY_MAX+200*Math.random();case"chaotic":return 500*Math.random();default:return this.INITIAL_DELAY_MIN+300*Math.random()}}calculateNextCooldown(){let t;switch(this.personality){case"aggressive":t=this.COOLDOWN_MIN+300*Math.random();break;case"cautious":t=this.COOLDOWN_MIN+200+500*Math.random();break;case"chaotic":t=this.COOLDOWN_MIN+Math.random()*(this.COOLDOWN_MAX-this.COOLDOWN_MIN);break;default:t=this.COOLDOWN_MIN+100+400*Math.random()}t*=1-.3*this.excitementLevel,this.consecutiveThrows>=2&&Math.random()<.4&&(t=this.BURST_COOLDOWN+150*Math.random(),console.log("[KnifeThrowAI] Adrenaline burst!")),this.opponentKnivesThrown-(6-this.knivesRemaining)>1&&(t*=.7),Math.random()<.08&&"aggressive"!==this.personality&&(t+=400+300*Math.random(),console.log("[KnifeThrowAI] Dramatic pause...")),this.nextThrowCooldown=Math.max(this.BURST_COOLDOWN,Math.min(this.COOLDOWN_MAX,t))}tick(t){const e=[],i=Date.now();if(this.discRotation+=this.discSpeed*this.discDirection*t,this.discRotation=(this.discRotation%360+360)%360,this.excitementLevel=Math.max(0,this.excitementLevel-5e-4*t),this.shouldThrow(i)){const t=this.performThrow(i);e.push(...t)}return e}shouldThrow(t){return!(t-this.lastThrowTime<this.nextThrowCooldown)&&!!this.roundStarted&&!(this.knivesRemaining<=0)&&!this.isWaitingForResult&&(0===this.waitStartTime&&(this.waitStartTime=t),this.decideToThrow(t))}findDiscGaps(){if(0===this.stuckAngles.length)return[{start:0,end:360,size:360,center:180}];const t=[...this.stuckAngles].sort((t,e)=>t-e),e=[];for(let i=0;i<t.length;i++){const s=t[i],n=t[(i+1)%t.length];let a,o;i===t.length-1?(a=360-s+n,o=(s+a/2)%360):(a=n-s,o=s+a/2),a>2*this.minAngleSeparation&&e.push({start:s,end:n,size:a,center:o})}return e.sort((t,e)=>e.size-t.size)}predictTimeToSafeAngle(){const t=this.findDiscGaps();if(0===t.length)return{timeMs:0,targetAngle:this.getImpactAngle()};const e=this.getImpactAngle(),i=t[0];if(this.getSafetyMargin(e)>=this.minAngleSeparation)return{timeMs:0,targetAngle:e};let s=(90-i.center+360)%360-this.discRotation;this.discDirection>0?s<0&&(s+=360):(s>0&&(s-=360),s=Math.abs(s));const n=s/Math.max(.5,this.discSpeed)*1e3;return{timeMs:Math.max(0,n-this.KNIFE_FLIGHT_TIME),targetAngle:i.center}}decideToThrow(t){const e=this.getImpactAngle(),i=this.getSafetyMargin(e),s=this.findDiscGaps(),n=s.length>0?s[0].size:0,a=this.predictTimeToSafeAngle(),o=t-this.waitStartTime;if(o>this.MAX_WAIT_TIME)return console.log(`[KnifeThrowAI] Force throw after ${o}ms wait`),!0;if(this.discSpeed<2&&n>40&&i>=8)return console.log(`[KnifeThrowAI] Easy shot - slow disc, big gap (${n.toFixed(0)}Â°)`),!0;if(i>=this.minAngleSeparation){const t=this.getThrowChanceByPersonality(i);if(Math.random()<t)return!0}if(a.timeMs>0&&a.timeMs<500)return!1;if(o>800){if(i>=8)return console.log(`[KnifeThrowAI] Impatient throw after ${o}ms`),!0;if(o>1200&&Math.random()<.5)return console.log(`[KnifeThrowAI] Risky throw after ${o}ms`),!0}return this.personalityRiskDecision(i,o)}getThrowChanceByPersonality(t){const e=Math.min(.3,(t-12)/60);switch(this.personality){case"aggressive":return.9+e;case"cautious":return.6+e;case"chaotic":return.5+.4*Math.random();default:return.75+e}}personalityRiskDecision(t,e){return"aggressive"===this.personality?t>=6||e>400&&Math.random()<.4:"cautious"===this.personality?t>=15||e>1e3&&t>=10:"chaotic"===this.personality?Math.random()<.15||t>=10&&Math.random()<.7:t>=10||(this.currentMomentum<-.3||this.excitementLevel>.7)&&Math.random()<.3}getSafetyMargin(t){let e=360;for(const i of this.stuckAngles){const s=this.angleDifference(t,i);e=Math.min(e,s)}return e}getImpactAngle(){return(90-this.discRotation+360)%360}isAngleSafe(t){return this.getSafetyMargin(t)>=this.minAngleSeparation}angleDifference(t,e){let i=Math.abs(t-e);return i>180&&(i=360-i),i}performThrow(t){const e=[];this.lastThrowTime=t,this.isWaitingForResult=!0,this.consecutiveThrows++,this.waitStartTime=0;const i=this.calculateThrowResult();console.log(`[KnifeThrowAI] Throwing knife - angle: ${i.angle.toFixed(1)}, success: ${i.success}, knives left: ${this.knivesRemaining-1}`);const n=s.KnifeThrowNetworkProtocol.encodeThrowStart({type:"throw_start",timestamp:t});n&&e.push(n);const a=s.KnifeThrowNetworkProtocol.encodeThrowKnife({type:"throw_knife",angle:i.angle,success:i.success,timestamp:t+this.KNIFE_FLIGHT_TIME});a&&e.push(a),this.knivesRemaining--,i.success?(this.stuckAngles.push(i.angle),this.currentMomentum+=.1):(this.currentMomentum-=.15,this.consecutiveThrows=0),this.calculateNextCooldown();const o=200+150*Math.random();return setTimeout(()=>{this.isWaitingForResult=!1},o),e}calculateThrowResult(){const t=this.getImpactAngle(),e=this.isAngleSafe(t),i=this.getSafetyMargin(t);let s=this.baseSkillLevel;return i<15&&(s*=.7+i/50),s+=.1*this.currentMomentum,this.excitementLevel>.6&&(s-=.05),e&&s>.7&&Math.random()<.12?(console.log("[KnifeThrowAI] Intentional close call for drama!"),{angle:t,success:Math.random()<.4}):(s=Math.max(.25,Math.min(.92,s)),{angle:t,success:e&&Math.random()<s})}reset(){this.knivesRemaining=6,this.opponentKnivesThrown=0,this.stuckAngles=[],this.discRotation=0,this.discSpeed=4,this.discDirection=1,this.lastThrowTime=0,this.nextThrowCooldown=600,this.roundStarted=!1,this.isWaitingForResult=!1,this.consecutiveThrows=0,this.waitStartTime=0,this.excitementLevel=0,this.currentMomentum=0,this.personality=this.pickRandomPersonality(),this.baseSkillLevel=this.calculateBaseSkill(),console.log(`[KnifeThrowAI] Reset with new personality: ${this.personality}, skill: ${this.baseSkillLevel.toFixed(2)}`)}}},436(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.PingPongAI=void 0;const s=i(164);e.PingPongAI=class{constructor(t){this.ball={x:0,y:0,z:0,vx:0,vy:0,vz:0,spin:0},this.paddle={x:0,y:0,vx:0,vy:0},this.opponent={x:0,y:0,vx:0,vy:0,lastUpdate:0},this.isServing=!0,this.currentServer="A",this.TABLE_WIDTH=300,this.TABLE_LENGTH=480,this.TABLE_HEIGHT=76,this.NET_HEIGHT=15,this.BAT_Y_A=240,this.BAT_Y_B=-240,this.MOVE_SPEED_X=280,this.MOVE_SPEED_Y=180,this.MAX_FORWARD_Y=180,this.MIN_BACKWARD_Y=260,this.GRAVITY=400,this.BOUNCE_DAMPING=.85,this.AIR_RESISTANCE=.995,this.reactionDelay=0,this.lastPrediction=null,this.targetPosition={x:0,y:240},this.lastUpdate=0,this.lastHitTime=0,this.ballReceivedTime=0,this.velocitySmoothing=.15,this.role=t,this.paddle.y=this.BAT_Y_A,this.paddle.x=0,this.personality=this.pickPersonality(),this.skillLevel=this.calculateSkillLevel(),console.log(`[PingPongAI] Initialized as ${t} with personality: ${this.personality}, skill: ${this.skillLevel.toFixed(2)}`),this.currentServer===this.role&&this.prepareServe()}pickPersonality(){const t=Math.random();return t<.25?"aggressive":t<.5?"defensive":t<.75?"balanced":"tricky"}calculateSkillLevel(){switch(this.personality){case"aggressive":return.65+.2*Math.random();case"defensive":return.7+.2*Math.random();case"balanced":return.65+.25*Math.random();case"tricky":return.6+.25*Math.random()}}toNetwork(t){return"B"===this.role?{x:-t.x,y:-t.y,z:t.z,vx:-t.vx,vy:-t.vy,vz:t.vz,spin:t.spin}:t}prepareServe(){this.currentServer===this.role&&(this.isServing=!0,this.ball={x:0,y:this.paddle.y-20,z:80,vx:0,vy:0,vz:0,spin:0})}fromNetwork(t){return"B"===this.role?{x:-t.x,y:-t.y,z:t.z,vx:-t.vx,vy:-t.vy,vz:t.vz,spin:t.spin}:t}onMessage(t){const e=s.NetworkProtocol.decode(t);if(e)if(console.log("[PingPongAI] Received message:",e.type),"hit"===e.type){const t=this.fromNetwork(e.state);console.log("[PingPongAI] Hit received, ball:",t.x.toFixed(1),t.y.toFixed(1),"vel:",t.vx.toFixed(1),t.vy.toFixed(1)),this.ball={...t},this.isServing=!1,this.ballReceivedTime=Date.now(),this.predictBallTrajectory()}else if("bat"===e.type){if(e.role!==this.role){const t=Date.now();"B"===this.role?(this.opponent.x=-e.x,this.opponent.y=-e.y,this.opponent.vx=-e.vx,this.opponent.vy=-e.vy):(this.opponent.x=e.x,this.opponent.y=e.y,this.opponent.vx=e.vx,this.opponent.vy=e.vy),this.opponent.lastUpdate=t}}else"score"===e.type&&(this.currentServer=e.currentServer,console.log(`[PingPongAI] Score update. Server is now: ${this.currentServer} (Me: ${this.role})`),this.currentServer===this.role?(this.lastHitTime=Date.now()+1e3,this.prepareServe()):this.isServing=!1,this.lastPrediction=null)}predictBallTrajectory(){if(this.ball.vy<=0)return void(this.lastPrediction=null);let t={...this.ball},e=0,i=0;const s=.01;for(;i<3;){if(t.vz-=this.GRAVITY*s,t.vx*=this.AIR_RESISTANCE,t.vy*=this.AIR_RESISTANCE,t.x+=t.vx*s,t.y+=t.vy*s,t.z+=t.vz*s,t.z<this.TABLE_HEIGHT&&t.vz<0&&Math.abs(t.x)<this.TABLE_WIDTH/2&&Math.abs(t.y)<this.TABLE_LENGTH/2&&(t.z=this.TABLE_HEIGHT,t.vz=-t.vz*this.BOUNCE_DAMPING,e++),Math.abs(t.x)>this.TABLE_WIDTH/2+50&&(t.vx=.8*-t.vx,t.x=Math.sign(t.x)*(this.TABLE_WIDTH/2+50)),t.y>=this.MAX_FORWARD_Y)return this.lastPrediction={x:t.x,y:t.y,time:i,bounces:e,confidence:Math.max(.5,1-.2*i-.1*e)},void console.log(`[PingPongAI] Predicted impact: x=${t.x.toFixed(1)}, y=${t.y.toFixed(1)}, time=${i.toFixed(2)}s, bounces=${e}`);if(t.y>this.MIN_BACKWARD_Y+50||t.z<0)break;i+=s}this.lastPrediction=null}tick(t){const e=[],i=Date.now();this.isServing&&this.currentServer===this.role?(this.ball.x=this.paddle.x,this.ball.y=this.paddle.y-20,this.ball.z=80,this.ball.vx=0,this.ball.vy=0,this.ball.vz=0,i-this.lastHitTime>1e3&&this.performServe(e)):(this.simulateBall(t),this.updatePaddleMovement(t,i),this.checkCollision(e));const n="B"===this.role?-this.paddle.x:this.paddle.x,a="B"===this.role?-this.paddle.y:this.paddle.y,o="B"===this.role?-this.paddle.vx:this.paddle.vx,r="B"===this.role?-this.paddle.vy:this.paddle.vy;return e.push(s.NetworkProtocol.encodeBatUpdate({role:this.role,x:n,y:a,vx:o,vy:r})),this.lastUpdate=i,e}simulateBall(t){this.ball.vz-=this.GRAVITY*t,this.ball.vx*=this.AIR_RESISTANCE,this.ball.vy*=this.AIR_RESISTANCE,this.ball.x+=this.ball.vx*t,this.ball.y+=this.ball.vy*t,this.ball.z+=this.ball.vz*t,this.ball.z<this.TABLE_HEIGHT&&this.ball.vz<0&&Math.abs(this.ball.x)<this.TABLE_WIDTH/2&&Math.abs(this.ball.y)<this.TABLE_LENGTH/2&&(this.ball.z=this.TABLE_HEIGHT,this.ball.vz=-this.ball.vz*this.BOUNCE_DAMPING),this.ball.z<0&&(this.ball.z=0,this.ball.vz=0)}updatePaddleMovement(t,e){const i=this.ball.vy>0;let s=0,n=this.BAT_Y_A;if(i)if(this.lastPrediction&&this.lastPrediction.confidence>.3){const t=this.lastPrediction;s=t.x;const e=30*(1-this.skillLevel);s+=(Math.random()-.5)*e;const i=t.time;i<.5?n="aggressive"===this.personality?this.MAX_FORWARD_Y+10:this.MAX_FORWARD_Y+30:i<1?n=this.BAT_Y_A-30:"defensive"===this.personality?n=this.MIN_BACKWARD_Y-20:"aggressive"===this.personality&&(n=this.BAT_Y_A-40)}else s=this.ball.x,Math.abs(this.paddle.y-this.ball.y)<200&&(n=this.BAT_Y_A-30);else if(e-this.opponent.lastUpdate<1e3){const t=this.opponent.x;switch(this.personality){case"aggressive":s=.4*-t,n=this.BAT_Y_A-40;break;case"defensive":s=0,n=this.MIN_BACKWARD_Y-30;break;case"tricky":s=.2*t+50*Math.sin(.002*e),n=this.BAT_Y_A+30*Math.cos(.003*e);break;default:s=.3*-t,n=this.BAT_Y_A-20}}else s=0,n=this.BAT_Y_A;const a=this.TABLE_WIDTH/2+60;s=Math.max(-a,Math.min(a,s)),n=Math.max(this.MAX_FORWARD_Y,Math.min(this.MIN_BACKWARD_Y,n));const o=s-this.paddle.x,r=n-this.paddle.y,h=this.MOVE_SPEED_X*t,l=this.MOVE_SPEED_Y*t;if(Math.abs(o)<h)this.paddle.x=s,this.paddle.vx=o/t*this.velocitySmoothing+this.paddle.vx*(1-this.velocitySmoothing);else{const t=Math.sign(o);this.paddle.x+=t*h,this.paddle.vx=t*this.MOVE_SPEED_X*this.velocitySmoothing+this.paddle.vx*(1-this.velocitySmoothing)}if(Math.abs(r)<l)this.paddle.y=n,this.paddle.vy=r/t*this.velocitySmoothing+this.paddle.vy*(1-this.velocitySmoothing);else{const t=Math.sign(r);this.paddle.y+=t*l,this.paddle.vy=t*this.MOVE_SPEED_Y*this.velocitySmoothing+this.paddle.vy*(1-this.velocitySmoothing)}}checkCollision(t){const e=Date.now();if(e-this.lastHitTime<400)return;const i=Math.abs(this.ball.y-this.paddle.y),n=Math.abs(this.ball.x-this.paddle.x);if(i<35&&n<45&&this.ball.z<120&&this.ball.z>40){if(!(this.ball.vy>0))return;let i,n,a;this.lastHitTime=e,this.lastPrediction=null;const o=e-this.opponent.lastUpdate<500;switch(this.personality){case"aggressive":n=500+100*Math.random(),i=o?-Math.sign(this.opponent.x)*(.3*this.TABLE_WIDTH+40*Math.random()):(Math.random()-.5)*this.TABLE_WIDTH*.6,a=5*(Math.random()-.5);break;case"defensive":n=380+80*Math.random(),i=(Math.random()-.5)*this.TABLE_WIDTH*.5,a=2*(Math.random()-.5);break;case"tricky":n=350+150*Math.random(),i=o&&Math.random()<.6?this.opponent.x+50*(Math.random()-.5):(Math.random()-.5)*this.TABLE_WIDTH*.7,a=8*(Math.random()-.5);break;default:n=420+80*Math.random(),i=o&&Math.random()<.7?-Math.sign(this.opponent.x)*(60*Math.random()+30):(Math.random()-.5)*this.TABLE_WIDTH*.6,a=4*(Math.random()-.5)}const r=.3;i+=this.paddle.vx*r;const h=.15*(1-this.skillLevel);Math.random()<h&&(i=(Math.random()-.5)*this.TABLE_WIDTH*1.2,n*=.6),i=Math.max(.45*-this.TABLE_WIDTH,Math.min(.45*this.TABLE_WIDTH,i));const l=-(this.TABLE_LENGTH/2-50);this.ball.vy=-n;const c=Math.abs((l-this.ball.y)/this.ball.vy);this.ball.vx=(i-this.ball.x)/c,this.ball.vz=180+80*Math.random(),this.ball.spin=a,this.paddle.vy<-10&&(this.ball.vy*=1.1),t.push(s.NetworkProtocol.encodeHitEvent({state:this.toNetwork(this.ball),isServing:!1})),console.log(`[PingPongAI] Hit! Target: (${i.toFixed(1)}, ${l.toFixed(1)}), power: ${n.toFixed(0)}`)}}performServe(t){let e,i;switch(this.lastHitTime=Date.now(),this.ball.x=this.paddle.x,this.ball.y=this.paddle.y-20,this.ball.z=80,this.personality){case"aggressive":e=-450-50*Math.random(),i=(Math.random()-.5)*this.TABLE_WIDTH*.6;break;case"tricky":e=-350-100*Math.random(),i=Math.random()<.5?.35*-this.TABLE_WIDTH+20*Math.random():.35*this.TABLE_WIDTH-20*Math.random();break;default:e=-400-60*Math.random(),i=120*(Math.random()-.5)}this.ball.vy=e,this.ball.vx=2*i,this.ball.vz=220+40*Math.random(),this.ball.spin=3*(Math.random()-.5),this.isServing=!1,t.push(s.NetworkProtocol.encodeHitEvent({state:this.toNetwork(this.ball),isServing:!0})),console.log(`[PingPongAI] Serve! Speed: ${e.toFixed(0)}, target: ${i.toFixed(0)}`)}reset(){this.paddle.x=0,this.paddle.y=this.BAT_Y_A,this.paddle.vx=0,this.paddle.vy=0,this.ball={x:0,y:0,z:0,vx:0,vy:0,vz:0,spin:0},this.lastPrediction=null,this.opponent={x:0,y:0,vx:0,vy:0,lastUpdate:0},this.personality=this.pickPersonality(),this.skillLevel=this.calculateSkillLevel(),console.log(`[PingPongAI] Reset with personality: ${this.personality}, skill: ${this.skillLevel.toFixed(2)}`)}}},563(t,e,i){var s=this&&this.__createBinding||(Object.create?function(t,e,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(e,i);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,s,n)}:function(t,e,i,s){void 0===s&&(s=i),t[s]=e[i]}),n=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||s(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),n(i(202),e),n(i(993),e)},601(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.TicTacToeAI=void 0;const s=i(625);e.TicTacToeAI=class{constructor(t){this.currentPlayer="A",this.isGameOver=!1,this.personality="perfect",this.moveDelay=800,this.lastMoveTime=0,this.waitingForMove=!1,this.role=t,this.board=Array(9).fill(null),this.personality=this.pickPersonality(),console.log(`[TicTacToeAI] Initialized as ${t} with personality: ${this.personality}`)}pickPersonality(){return Math.random()<.9?"perfect":"balanced"}onMessage(t){const e=s.TicTacToeNetworkProtocol.decode(t);if(e)switch(console.log("[TicTacToeAI] Received message:",e.type),e.type){case"move":this.handleMove(e.index,"A"===this.role?"B":"A",!1);break;case"reset":this.resetGame()}}handleMove(t,e,i){null!==this.board[t]||this.isGameOver||(this.board[t]=e,this.checkWin(e)?(this.isGameOver=!0,console.log(`[TicTacToeAI] Game Over: ${e} wins!`)):this.board.every(t=>null!==t)?(this.isGameOver=!0,console.log("[TicTacToeAI] Game Over: Draw!")):(this.currentPlayer="A"===this.currentPlayer?"B":"A",i?this.waitingForMove=!1:this.currentPlayer===this.role&&(this.waitingForMove=!0,this.lastMoveTime=Date.now())))}tick(t){const e=[];if(!this.isGameOver&&this.currentPlayer===this.role&&this.waitingForMove&&Date.now()-this.lastMoveTime>this.moveDelay){const t=this.decideMove();-1!==t&&(this.handleMove(t,this.role,!0),e.push(s.TicTacToeNetworkProtocol.encodeMove({index:t})),this.checkWin(this.role)?e.push(s.TicTacToeNetworkProtocol.encodeGameOver({winnerRole:this.role})):this.board.every(t=>null!==t)&&e.push(s.TicTacToeNetworkProtocol.encodeGameOver({winnerRole:null})))}return e}decideMove(){const t=this.board.filter(t=>null===t).length;return 9===t||8===t&&null===this.board[4]?4:"balanced"===this.personality&&Math.random()<.1?this.getRandomMove():this.getBestMove()}getRandomMove(){const t=[];return this.board.forEach((e,i)=>{null===e&&t.push(i)}),0===t.length?-1:t[Math.floor(Math.random()*t.length)]}getBestMove(){let t=-1/0,e=-1;for(let i=0;i<9;i++)if(null===this.board[i]){this.board[i]=this.role;const s=this.minimax(this.board,0,!1);this.board[i]=null,s>t&&(t=s,e=i)}return e}minimax(t,e,i){const s="A"===this.role?"B":"A";if(this.checkWin(this.role))return 10-e;if(this.checkWin(s))return e-10;if(t.every(t=>null!==t))return 0;if(i){let i=-1/0;for(let s=0;s<9;s++)if(null===t[s]){t[s]=this.role;const n=this.minimax(t,e+1,!1);t[s]=null,i=Math.max(n,i)}return i}{let i=1/0;for(let n=0;n<9;n++)if(null===t[n]){t[n]=s;const a=this.minimax(t,e+1,!0);t[n]=null,i=Math.min(a,i)}return i}}checkWin(t){return[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]].some(e=>{const[i,s,n]=e;return this.board[i]===t&&this.board[s]===t&&this.board[n]===t})}resetGame(){this.board.fill(null),this.isGameOver=!1,this.currentPlayer="A",this.waitingForMove=this.currentPlayer===this.role,this.waitingForMove&&(this.lastMoveTime=Date.now()),console.log("[TicTacToeAI] Game Reset")}}},625(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.TicTacToeNetworkProtocol=e.MSG_TYPE=void 0,e.MSG_TYPE={MOVE:1,RESET:2,GAME_OVER:3,PING:4},e.TicTacToeNetworkProtocol=class{static encode(t){switch(t.type){case"move":return this.encodeMove(t);case"reset":return this.encodeReset(t);case"game_over":return this.encodeGameOver(t);case"ping":return this.encodePing(t);default:return console.error("Unknown message type for encoding:",t.type),null}}static decode(t){const i=new DataView(t);switch(i.getUint8(0)){case e.MSG_TYPE.MOVE:return this.decodeMove(i);case e.MSG_TYPE.RESET:return{type:"reset"};case e.MSG_TYPE.GAME_OVER:return this.decodeGameOver(i);case e.MSG_TYPE.PING:return{type:"ping"};default:return null}}static encodeMove(t){const i=new ArrayBuffer(2),s=new DataView(i);return s.setUint8(0,e.MSG_TYPE.MOVE),s.setUint8(1,t.index),i}static decodeMove(t){return{type:"move",index:t.getUint8(1)}}static encodeReset(t){const i=new ArrayBuffer(1);return new DataView(i).setUint8(0,e.MSG_TYPE.RESET),i}static encodeGameOver(t){const i=new ArrayBuffer(2),s=new DataView(i);return s.setUint8(0,e.MSG_TYPE.GAME_OVER),s.setUint8(1,"A"===t.winnerRole?1:"B"===t.winnerRole?2:0),i}static decodeGameOver(t){const e=t.getUint8(1);return{type:"game_over",winnerRole:1===e?"A":2===e?"B":null}}static encodePing(t){const i=new ArrayBuffer(1);return new DataView(i).setUint8(0,e.MSG_TYPE.PING),i}}},673(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.BotClient=void 0;const s=i(756);e.BotClient=class{constructor(t,e=""){this.gameAI=null,this.gameType=null,this.role="B",this.gameLoopInterval=null,this.gameChannelReliable=null,this.gameChannelUnreliable=null,this.chatChannel=null,this.persona=t,this.backendUrl=e||window.location.origin,console.log(`[BotClient] Created bot: ${t.name}`)}getPersona(){return this.persona}setRole(t){this.role=t,this.gameType?this.gameAI=s.GameFactory.createGame(this.gameType,t):(console.log(`[BotClient] Role set to ${t}, but no game type set. Waiting for game type.`),this.gameAI=null)}setGameType(t){this.gameType=t,console.log(`[BotClient] Game type set to: ${t}`),this.role&&(this.gameAI=s.GameFactory.createGame(this.gameType,this.role))}setupGameChannel(t){const e=t.label;console.log(`[BotClient] Setting up game channel: ${e}`),"game_reliable"===e?this.gameChannelReliable=t:this.gameChannelUnreliable=t,t.binaryType="arraybuffer",t.onopen=()=>{console.log(`[BotClient] Game channel ${e} OPEN`),"game_unreliable"!==e&&this.gameChannelReliable||this.startGameLoop()},t.onmessage=t=>{if(this.gameAI){let e;if(t.data instanceof ArrayBuffer)e=t.data;else{if(t.data instanceof Blob)return void t.data.arrayBuffer().then(t=>{var e;null===(e=this.gameAI)||void 0===e||e.onMessage(t)});e=t.data}this.gameAI.onMessage(e)}},t.onclose=()=>{console.log(`[BotClient] Game channel ${e} CLOSED`),"game_unreliable"===e&&this.stopGameLoop()}}setupChatChannel(t){this.chatChannel=t,t.onopen=()=>{console.log("[BotClient] Chat channel OPEN"),this.sendBotInfo(),this.sendGreeting()},t.onmessage=async t=>{await this.handleChatMessage(t.data)},t.onclose=()=>{console.log("[BotClient] Chat channel CLOSED")}}startGameLoop(){this.gameLoopInterval&&clearInterval(this.gameLoopInterval),console.log("[BotClient] Starting game loop"),this.gameLoopInterval=window.setInterval(()=>{const t=this.gameChannelUnreliable||this.gameChannelReliable;if(this.gameAI&&(!t||t.readyState),this.gameAI&&t&&"open"===t.readyState){const e=1/60,i=this.gameAI.tick(e);i.length>0&&Math.random()<.01&&console.log(`[BotClient] Sending ${i.length} messages (Sample)`),i.forEach(e=>{try{t.send(e)}catch(t){console.error("[BotClient] Send error:",t)}})}},1e3/60)}stopGameLoop(){this.gameLoopInterval&&(clearInterval(this.gameLoopInterval),this.gameLoopInterval=null)}sendBotInfo(){if(this.chatChannel&&"open"===this.chatChannel.readyState){const t={type:"bot_info",payload:{id:this.persona.id,name:this.persona.name,avatar:this.persona.avatar}};this.chatChannel.send(JSON.stringify(t))}}async sendGreeting(){try{const t=await this.getLLMResponse(`Say a short, friendly greeting as ${this.persona.name}. Just one sentence, be casual and welcoming.`);this.chatChannel&&"open"===this.chatChannel.readyState&&this.chatChannel.send(JSON.stringify({type:"chat",payload:t,sender:"bot"}))}catch(t){console.error("[BotClient] Greeting error:",t),this.chatChannel&&"open"===this.chatChannel.readyState&&this.chatChannel.send(JSON.stringify({type:"chat",payload:`Hey there! I'm ${this.persona.name}. Nice to meet you! ðŸ‘‹`,sender:"bot"}))}}async handleChatMessage(t){try{const e="string"==typeof t?t:(new TextDecoder).decode(t);let i=e;try{const t=JSON.parse(e);if("game_invite"===t.type)return console.log("[BotClient] Received game invite:",t.payload),void(this.chatChannel&&"open"===this.chatChannel.readyState&&(console.log("[BotClient] Auto-accepting game invite"),this.chatChannel.send(JSON.stringify({type:"game_accept",payload:t.payload}))));if("game_accept"===t.type||"game_reject"===t.type||"game_leave"===t.type||"game_cancel"===t.type)return void console.log("[BotClient] Game control message:",t.type);if("chat"===t.type)i=t.payload;else if(t.content)i=t.content;else{if(!t.message)return;i=t.message}}catch(t){}const s=await this.getLLMResponse(i),n=Math.min(Math.max(30*s.length,2e3),5e3);await new Promise(t=>setTimeout(t,n)),this.chatChannel&&"open"===this.chatChannel.readyState&&this.chatChannel.send(JSON.stringify({type:"chat",payload:s,sender:"bot"}))}catch(t){console.error("[BotClient] Chat error:",t)}}sendTypingIndicator(t){this.chatChannel&&"open"===this.chatChannel.readyState&&this.chatChannel.send(JSON.stringify({type:"typing",payload:{isTyping:t}}))}async getLLMResponse(t){try{const e=await fetch(`${this.backendUrl}/api/bot-chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({systemPrompt:this.persona.systemPrompt,message:t})});if(!e.ok)throw new Error(`API error: ${e.status}`);return(await e.json()).response||"Hmm, let me think..."}catch(t){console.error("[BotClient] LLM API error:",t);const e=["Nice move!","Good game!","Let's keep playing!","You're doing great!","That was close!"];return e[Math.floor(Math.random()*e.length)]}}cleanup(){this.stopGameLoop(),this.gameChannelReliable&&(this.gameChannelReliable.close(),this.gameChannelReliable=null),this.gameChannelUnreliable&&(this.gameChannelUnreliable.close(),this.gameChannelUnreliable=null),this.chatChannel&&(this.chatChannel.close(),this.chatChannel=null),this.gameAI=null,console.log("[BotClient] Cleaned up")}}},682(t,e,i){var s=this&&this.__createBinding||(Object.create?function(t,e,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(e,i);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,s,n)}:function(t,e,i,s){void 0===s&&(s=i),t[s]=e[i]}),n=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||s(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),n(i(436),e),n(i(164),e)},756(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.GameFactory=void 0;const s=i(682),n=i(563),a=i(601);e.GameFactory=class{static createGame(t,e="B"){switch(t){case"ping-pong":return console.log("[GameFactory] Creating PingPongAI"),new s.PingPongAI(e);case"knife-throw":return console.log("[GameFactory] Creating KnifeThrowAI"),new n.KnifeThrowAI;case"tic-tac-toe":return console.log("[GameFactory] Creating TicTacToeAI"),new a.TicTacToeAI(e);default:return console.log("[GameFactory] Unknown or null game type:",t),null}}}},993(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.KnifeThrowNetworkProtocol=e.MSG_TYPE=void 0,e.MSG_TYPE={THROW_KNIFE:1,THROW_START:2,ROUND_SETUP:3,ROTATION_UPDATE:4,PING:5},e.KnifeThrowNetworkProtocol=class{static encode(t){switch(t.type){case"throw_knife":return this.encodeThrowKnife(t);case"throw_start":return this.encodeThrowStart(t);case"round_setup":return this.encodeRoundSetup(t);case"rotation_update":return this.encodeRotationUpdate(t);case"ping":return this.encodePing(t);default:return console.error("Unknown message type for encoding:",t.type),null}}static decode(t){const i=new DataView(t),s=i.getUint8(0);switch(s){case e.MSG_TYPE.THROW_KNIFE:return this.decodeThrowKnife(i);case e.MSG_TYPE.THROW_START:return this.decodeThrowStart(i);case e.MSG_TYPE.ROUND_SETUP:return this.decodeRoundSetup(i);case e.MSG_TYPE.ROTATION_UPDATE:return this.decodeRotationUpdate(i);case e.MSG_TYPE.PING:return{type:"ping"};default:return console.error("Unknown message type for decoding:",s),null}}static encodeThrowKnife(t){const i=new ArrayBuffer(8),s=new DataView(i);return s.setUint8(0,e.MSG_TYPE.THROW_KNIFE),s.setUint16(1,Math.round(100*t.angle)),s.setUint8(3,t.success?1:0),s.setUint32(4,t.timestamp),i}static encodeThrowStart(t){const i=new ArrayBuffer(5),s=new DataView(i);return s.setUint8(0,e.MSG_TYPE.THROW_START),s.setUint32(1,t.timestamp),i}static encodeRoundSetup(t){const i=t.dummyKnives.length,s=new ArrayBuffer(2+2*i),n=new DataView(s);n.setUint8(0,e.MSG_TYPE.ROUND_SETUP),n.setUint8(1,i);for(let e=0;e<i;e++)n.setUint16(2+2*e,Math.round(100*t.dummyKnives[e]));return s}static encodeRotationUpdate(t){const i=new ArrayBuffer(8),s=new DataView(i);return s.setUint8(0,e.MSG_TYPE.ROTATION_UPDATE),s.setUint16(1,Math.round(1e3*t.speed)),s.setInt8(3,t.direction),s.setUint32(4,t.timestamp),i}static encodePing(t){const i=new ArrayBuffer(1);return new DataView(i).setUint8(0,e.MSG_TYPE.PING),i}static decodeThrowKnife(t){return{type:"throw_knife",angle:t.getUint16(1)/100,success:1===t.getUint8(3),timestamp:t.getUint32(4)}}static decodeThrowStart(t){return{type:"throw_start",timestamp:t.getUint32(1)}}static decodeRoundSetup(t){const e=t.getUint8(1),i=[];for(let s=0;s<e;s++)i.push(t.getUint16(2+2*s)/100);return{type:"round_setup",dummyKnives:i}}static decodeRotationUpdate(t){return{type:"rotation_update",speed:t.getUint16(1)/1e3,direction:t.getInt8(3),timestamp:t.getUint32(4)}}}}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var a=e[s]={exports:{}};return t[s].call(a.exports,a,a.exports,i),a.exports}var s={};return(()=>{var t=s;const e=i(673);t.default=e.BotClient})(),s.default})());